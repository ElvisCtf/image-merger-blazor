@page "/"
@inject IJSRuntime Js

<div class="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100">
  <!-- Header -->
  <header class="px-6 py-5 border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-4xl mx-auto flex items-center justify-between">
      <h1 class="text-xl font-semibold">Image Merger</h1>
      <span class="text-sm text-gray-500 dark:text-gray-400">All processing happens client-side</span>
    </div>
  </header>
  
  <main class="max-w-4xl mx-auto px-6 py-8">
    <!-- Upload and preview -->
    <section aria-labelledby="upload-title" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
      <h2 id="upload-title" class="text-lg font-semibold mb-4">Upload images</h2>

      <!-- Dropzone -->
      <div
        id="dropzone"
        class="relative rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-700 p-6 text-center hover:border-blue-500 transition"
      >
        <p class="text-sm mb-3">Drag and drop two images here, or use the buttons below</p>
        <div class="flex flex-wrap gap-3 justify-center">
          <label class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 cursor-pointer">
            Choose First Image
            <InputFile OnChange="HandleFileA" id="fileA" accept="image/*" class="hidden" />
          </label>
          
          <label class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 cursor-pointer">
            Choose Second Image
            <InputFile OnChange="HandleFileB" id="fileB" accept="image/*" class="hidden" />
          </label>
          
          <button @onclick="ClearImages"
                  id="clearFiles" type="button" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">
            Clear
          </button>
        </div>
      </div>

      <!-- Previews -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
        <div class="rounded-lg border border-gray-200 dark:border-gray-700 p-3">
          <h3 class="text-sm font-medium mb-2">First image</h3>
          
          <div class="aspect-video bg-gray-50 dark:bg-gray-900/50 rounded flex items-center justify-center overflow-hidden">
            @if (!string.IsNullOrEmpty(_previewAUrl))
            {
              <img src="@_previewAUrl" class="max-h-64 object-contain" />
            }
            else
            {
              <span class="text-xs text-gray-500">No image selected</span>
            }
          </div>
        </div>
        
        <div class="rounded-lg border border-gray-200 dark:border-gray-700 p-3">
          <h3 class="text-sm font-medium mb-2">Second image</h3>
          
          <div class="aspect-video bg-gray-50 dark:bg-gray-900/50 rounded flex items-center justify-center overflow-hidden">
            @if (!string.IsNullOrEmpty(_previewBUrl))
            {
              <img src="@_previewBUrl" class="max-h-64 object-contain" />
            }
            else
            {
              <span class="text-xs text-gray-500">No image selected</span>
            }
          </div>
        </div>
      </div>
    </section>

    <!-- Options -->
    <section aria-labelledby="options-title" class="mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
      <h2 id="options-title" class="text-lg font-semibold mb-4">Merge options</h2>

      <!-- Orientation -->
      <div class="my-3">
        <div class="text-xs font-medium uppercase tracking-wide text-gray-800 dark:text-gray-100">Orientation</div>
        
        <div class="mt-2 flex items-center gap-6">
          <InputRadioGroup @bind-Value="_orientation">
            <label class="inline-flex items-center cursor-pointer">
              <InputRadio Value=@("vertical") class="accent-blue-600" />
              <span class="text-base ml-2">Vertical</span>
            </label>

            <label class="inline-flex items-center cursor-pointer">
              <InputRadio Value=@("horizontal") class="accent-blue-600" />
              <span class="text-base ml-2">Horizontal</span>
            </label>
          </InputRadioGroup>
        </div>
      </div>

      <!-- Alignment -->
      <div class="my-3">
        <label class="text-xs font-medium uppercase tracking-wide text-gray-800 dark:text-gray-100">Alignment</label>
        
        <select @bind="_alignment"
                class="mt-2 w-full px-3 pr-8 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900">
          <option value="center">Center</option>
          <option value="start">Start (top/left)</option>
          <option value="end">End (bottom/right)</option>
        </select>
      </div>
      
      <!-- Spacing -->
      <div class="my-3">
        <label class="text-xs font-medium uppercase tracking-wide text-gray-800 dark:text-gray-100">Spacing (px)</label>
        
        <input type="number" min="0" @bind="_spacing"
               class="mt-2 w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900" />
      </div>

      <!-- Background -->
      <div class="my-3">
        <label class="text-xs font-medium uppercase tracking-wide text-gray-800 dark:text-gray-100">Background</label>
        
        <div class="mt-2 flex items-center gap-3">
          <input type="color" @bind="_background"
                 class="h-10 w-16 rounded cursor-pointer" />
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" @bind="_transparent" class="accent-blue-600" />
            <span class="text-sm">Use transparent background (PNG)</span>
          </label>
        </div>
      </div>

      <!-- Actions -->
      <div class="mt-6 flex flex-wrap justify-center gap-3">
        <button @onclick="SwapImage"
                disabled="@IsMissingInputImages"
                id="swap" type="button"
                class="w-full sm:flex-1 sm:max-w-xs px-4 py-2 bg-amber-600 text-white rounded-lg 
                 hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Swap images
        </button>
        
        <button @onclick="MergeImages"
                disabled="@(_isMerging || IsMissingInputImages)"
                id="merge" type="button"
                class="w-full sm:flex-1 sm:max-w-xs px-4 py-2 bg-blue-600 text-white rounded-lg shadow 
                 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Merge images
        </button>

        <button @onclick="DownloadImage"
                disabled="@string.IsNullOrEmpty(_mergedResult)"
                id="download" type="button"
                class="w-full sm:flex-1 sm:max-w-xs px-4 py-2 bg-emerald-600 text-white rounded-lg shadow 
                 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Download result
        </button>
      </div>
      
      <!-- Progress bar --> 
      @if (_isMerging)
{
  <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
          <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 100%"></div>
        </div> 
  <p class="text-xs text-gray-500 mt-2">Merging images… please wait</p>
}
    </section>

    <!-- Result -->
    <section aria-labelledby="result-title" class="mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
      <h2 id="result-title" class="text-lg font-semibold mb-4">Result</h2>
      <div class="rounded-lg border border-gray-200 dark:border-gray-700 p-3 bg-gray-50 dark:bg-gray-900/50">
        <div class="flex items-center justify-center overflow-auto">
          <!-- Use canvas for merging output -->
          <canvas id="resultCanvas" class="max-h-[60vh] rounded bg-white dark:bg-gray-900"></canvas>
        </div>
        <p id="resultHint" class="mt-3 text-xs text-gray-500">Merge to see the output here. You can right-click → Save image or use Download.</p>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-300 dark:border-gray-700 mt-6 py-6 text-center text-xs text-gray-500 dark:text-gray-400">
    Built with Blazor WebAssembly + Tailwind CSS. No files leave your device.
  </footer>
</div>